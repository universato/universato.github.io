<!DOCTYPE html>
<html>
<head>
  <title>カレンダー日付選択</title>
  <link rel="stylesheet" type="text/css" href="schedule.css">
</head>
<body>
  <h4>カレンダー日付選択</h4>
  <p>本日の日付: <span id="today"></span></p>

  <div class="calendar" id="calendar">
    <div class="calendar-header">
      <button onclick="previousMonth()">&lt;</button>
      <span id="month-year"></span>
      <button onclick="nextMonth()">&gt;</button>
    </div>
    <div class="calendar-days" id="calendar-days"></div>
  </div>

  <label for="selectedDate">選択された日付:</label>
  <input type="text" id="selectedDate" readonly>
  <br>
  <label for="textArea"></label>
  <textarea id="textArea" rows="4" cols="50"></textarea>

  <script>
    const currentDate = new Date();
    let selectedDate = null;

    function generateCalendar() {
      const calendarDays = document.getElementById("calendar-days");
      calendarDays.innerHTML = "";

      const monthYear = document.getElementById("month-year");
      monthYear.innerText = formatDate(currentDate, "yyyy年M月");

      const todayDiv = document.getElementById("today");
      todayDiv.innerText = formatDate(new Date(), "yyyy年M月d日(ddd)");

      const today = new Date();

      const firstDay = new Date(currentDate.getFullYear(), currentDate.getMonth(), 1);
      const lastDay = new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 0);

      // 曜日の表示
      const weekdays = ['日', '月', '火', '水', '木', '金', '土'];
      for (let i = 0; i < weekdays.length; i++) {
        const weekday = document.createElement("div");
        weekday.classList.add("calendar-day");
        weekday.innerText = weekdays[i];
        calendarDays.appendChild(weekday);
      }

      // Fill in empty days for the first week
      for (let i = 0; i < firstDay.getDay(); i++) {
        const emptyDay = document.createElement("div");
        emptyDay.classList.add("calendar-day");
        emptyDay.innerText = "";
        calendarDays.appendChild(emptyDay);
      }

      // Generate calendar days
      for (let day = 1; day <= lastDay.getDate(); day++) {
        const calendarDay = document.createElement("div");
        calendarDay.classList.add("calendar-day");
        calendarDay.innerText = day;

        const date = new Date(currentDate.getFullYear(), currentDate.getMonth(), day);

        if (selectedDate && isSameDate(currentDate, selectedDate) && day === selectedDate.getDate()) {
          calendarDay.classList.add("selected-day");
        }

        if (date.getDay() === 6) {
          calendarDay.classList.add("saturday");
        } else if (date.getDay() === 0) {
          calendarDay.classList.add("sunday");
        }

        if (isSameDate(date, today)) {
          calendarDay.classList.add("today");
        }

        calendarDay.addEventListener("click", function(e) {
          const day = e.target.innerText;
          selectedDate = new Date(currentDate.getFullYear(), currentDate.getMonth(), day);

          const selectedDateInput = document.getElementById("selectedDate");
          selectedDateInput.value = formatDate(selectedDate, "yyyy年M月d日(ddd)");

          const textArea = document.getElementById("textArea");
          const selectedDateString = formatDate(selectedDate, "yyyy年M月d日(ddd)");
          textArea.value += selectedDateString + "\n";

          generateCalendar();
        });

        calendarDays.appendChild(calendarDay);
      }
    }

    function previousMonth() {
      currentDate.setMonth(currentDate.getMonth() - 1);
      generateCalendar();
    }

    function nextMonth() {
      currentDate.setMonth(currentDate.getMonth() + 1);
      generateCalendar();
    }

    function formatDate(date, format) {
      const options = {
        year: "numeric",
        month: "numeric",
        day: "numeric",
        weekday: "short"
      };

      return date.toLocaleDateString("ja-JP", options).replace(/(\d+)\/(\d+)\/(\d+)\((.)\)/, function(_, year, month, day, weekday) {
        return format.replace("yyyy", year).replace("M", month).replace("d", day).replace("ddd", weekday);
      });
    }

    function isSameDate(date1, date2) {
      return date1.getFullYear() === date2.getFullYear()
        && date1.getMonth() === date2.getMonth()
        && date1.getDate() === date2.getDate();
    }

    generateCalendar();
  </script>
</body>
</html>
